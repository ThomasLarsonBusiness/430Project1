(()=>{const e={"Rebel Alliance":["A-wing","ARC-170","Attack Shuttle","B-wing","CR90 Corvette","E-wing","GR-75 Medium Transport","HWK-290","K-wing","Scurrg H-6 Bomber","TIE Fighter","U-wing","VCX-100","X-wing","Y-wing","YT-1300","YT-2400","Z-95 Headhunter"],"Galactic Empire":["Firespray-31","Gozanti-class Cruiser","Lambda-class Shuttle","Raider-class Corvete","TIE Advanced","TIE Aggressor","TIE Adv. Prototype","TIE Bomber","TIE Defender","TIE Fighter","TIE Interceptor","TIE Phantom","TIE Punisher","TIE Striker","VT-49 Decimator"],"Scum and Villainy":["Aggressor","C-ROC Cruiser","Firespray-31","G-1A Starfighter","HWK-290","JumpMaster 5000","Kihraxz Fighter","Lancer-class Pursuit Craft","M3-A Interceptor","Protectorate Starfighter","Quadjumper","Scurrg H-6 Bomber","StarViper","Y-wing","YV-666","Z-95 Headhunter"]};let t,n,o;const a=async()=>{const e={user:window.location.search.split("&")[0].split("=")[1],squadron:n},t=await fetch("/saveSquadron",{method:"post",headers:{"content-type":"application/json",accept:"application/json"},body:JSON.stringify(e)});c(t,"save")},i=()=>{document.querySelector("#stats").textContent=`Points: ${n.currentPoints}/${n.maxPoints}     \n  Faction: ${n.faction}`;const e=document.querySelector("#squadron");e.innerHTML="";for(const t in n.ships)for(let a=0;a<n.ships[t].count;a++){const a=document.createElement("div");a.classList.add("ship");const s=document.createElement("p"),c=document.createElement("p");s.textContent=`Pilot: ${n.ships[t].name}`,c.textContent=`Points: ${n.ships[t].points}`;const d=document.createElement("button");d.textContent="Remove From Squadron",n.ships[t].image.length>1&&(a.classList.add("bigShip"),a.classList.remove("ship")),d.addEventListener("click",(()=>{n.currentPoints-=n.ships[t].points,n.ships[t].count>1?n.ships[t].count--:delete n.ships[t],o.textContent="Ship Removed",i()})),a.appendChild(s),a.appendChild(c);for(const e in n.ships[t].image){const o=document.createElement("img");o.src=`/getImage?path=${n.ships[t].image[e]}`,a.appendChild(o)}a.appendChild(d),e.appendChild(a)}},s=(e,t,a)=>{o.textContent="Ship Added",n.ships[e]?n.ships[e].count++:n.ships[e]={name:e,points:t,image:a,count:1},n.currentPoints+=t,i()},c=async(a,d)=>{const{status:r}=a;if(200===r){const r=await a.json();if("squadron"===d){n=r.content,t=n.faction,document.querySelector("#squadronName").textContent+=n.name;const o=document.querySelector("#pilots");o.innerHTML="";for(const n in e[t]){const a=document.createElement("div"),i=document.createElement("p");i.textContent=e[t][n]+" \\/",i.classList.add("title"),a.classList.add("tab"),a.id=e[t][n].replace(/ /g,"-"),i.addEventListener("click",(()=>{let e=a.getElementsByClassName("ship");a.getElementsByClassName("bigShip");for(let t in e)e[t].hidden?e[t].hidden=!1:e[t].hidden=!0})),a.appendChild(i),o.appendChild(a)}i();const a=await fetch(`/getFactionData?faction=${t}`,{method:"get",headers:{accept:"application/json"}});c(a,"pilots")}else if("pilots"===d)for(const a in e[t]){const i=document.getElementById(`${e[t][a].replace(/ /g,"-")}`);if("Rebel Alliance"===t&&"CR90 Corvette"===e[t][a]){const e=document.createElement("div");e.id="CR90-Corvette";const t=document.createElement("p"),a=document.createElement("p");let c=r.content[35].points+r.content[36].points;t.textContent="Ship: CR90 Corvette",a.textContent=`Points: ${c}`;const d=document.createElement("button");d.textContent="Add To Squadron",d.addEventListener("click",(()=>{n.currentPoints+90>n.maxPoints?o.textContent="Cannot Add Ship, Exceeds Max Squadron Value":s("CR90 Corvette",90,[r.content[35].image,r.content[36].image])}));const p=document.createElement("img"),l=document.createElement("img");p.src=`/getImage?path=${r.content[35].image}`,l.src=`/getImage?path=${r.content[36].image}`,p.alt="Ship Card",l.alt="Ship Card",e.appendChild(t),e.appendChild(a),e.appendChild(p),e.appendChild(l),e.appendChild(d),e.classList.add("ship"),e.classList.add("bigShip"),e.hidden=!0,i.appendChild(e)}else if("Galactic Empire"===t&&"Raider-class Corvete"===e[t][a]){const e=document.createElement("div");e.id="Raider-class-Corvete";const t=document.createElement("p"),a=document.createElement("p");let c=r.content[49].points+r.content[50].points;t.textContent="Ship: CR90 Corvette",a.textContent=`Points: ${c}`;const d=document.createElement("button");d.textContent="Add To Squadron",d.addEventListener("click",(()=>{n.currentPoints+c>n.maxPoints?o.textContent="Cannot Add Ship, Exceeds Max Squadron Value":s("Raider-class Corvete",c,[r.content[49].image,r.content[50].image])}));const p=document.createElement("img"),l=document.createElement("img");p.src=`/getImage?path=${r.content[49].image}`,l.src=`/getImage?path=${r.content[50].image}`,p.alt="Ship Card",l.alt="Ship Card",e.appendChild(t),e.appendChild(a),e.appendChild(p),e.appendChild(l),e.appendChild(d),e.classList.add("ship"),e.classList.add("bigShip"),e.hidden=!0,i.appendChild(e)}else{const c=r.content.filter((n=>n.ship===e[t][a]));for(const e in c){const t=document.createElement("div");t.id=c[e].name;const a=document.createElement("p"),d=document.createElement("p");a.textContent=`Pilot: ${c[e].name}`,d.textContent=`Points: ${c[e].points}`;const r=document.createElement("button");r.textContent="Add To Squadron",r.addEventListener("click",(()=>{n.currentPoints+c[e].points>n.maxPoints?o.textContent="Cannot Add Ship, Exceeds Max Squadron Value":s(c[e].name,c[e].points,[c[e].image])}));const p=document.createElement("img");p.src=`/getImage?path=${c[e].image}`,t.appendChild(a),t.appendChild(d),t.appendChild(p),t.appendChild(r),t.classList.add("ship"),t.hidden=!0,i.appendChild(t)}}}}else if(204===r)o.textContent="Squadron Saved";else if(400===r){const e=await a.json();o.textContent=`${e.message}`}else if(404===r){const e=await a.json();o.textContent=`${e.message}`}};window.onload=async()=>{o=document.getElementById("message");const e=await fetch(`/getSquadronInfo${window.location.search}`,{method:"get",headers:{"content-type":"application:x-www-form-urlencoded",accept:"application/json"}});c(e,"squadron"),document.querySelector("#home").addEventListener("click",(()=>{window.location.href="/"})),document.querySelector("#save").addEventListener("click",a)}})();